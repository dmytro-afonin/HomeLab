---
description: HomeLab project rules - LM Studio + Open WebUI setup for macOS
globs: ["**/*"]
alwaysApply: true
---

# HomeLab Project Guidelines

## Project Overview
A streamlined setup for running **LM Studio** (with MLX acceleration) and **Open WebUI** on macOS. Designed for Apple Silicon Macs to leverage native ML performance.

## Architecture

### Why This Stack
- **LM Studio** ‚Äî Uses Apple's MLX framework for native M1/M2/M3/M4 acceleration
- **Open WebUI** ‚Äî ChatGPT-like interface, runs in Docker
- **Watchtower** ‚Äî Auto-updates containers daily
- **caffeinate** ‚Äî Prevents Mac from sleeping during inference

### Components
| File | Purpose |
|------|---------|
| `start.sh` | Main orchestration script |
| `docker-compose.yml` | Container definitions |
| `install-launchagent.sh` | Installs auto-start |
| `com.homelab.start.plist.template` | LaunchAgent template (paths are placeholders) |

### Services
| Service | Port | Notes |
|---------|------|-------|
| LM Studio | 1234 | Native macOS, MLX/GGUF models |
| Open WebUI | 3000 | Docker container |
| Watchtower | ‚Äî | Updates at 2 AM daily |

## Code Standards

### Shell Scripts
- Shebang: `#!/usr/bin/env bash`
- Strict mode: `set -euo pipefail`
- Check command exists: `if command -v <cmd> >/dev/null 2>&1`
- Check process running: `pgrep -x <process>`
- Emoji status prefixes:
  - ‚úÖ Success
  - üß† LM Studio
  - üêã Docker Desktop
  - üê≥ Containers
  - ‚ö†Ô∏è Warning
  - ‚ùå Error

### Docker Compose
- Use `restart: unless-stopped`
- Named volumes for persistence
- Environment variables via `.env`

### LaunchAgent
- Use template with `{{HOMELAB_PATH}}` placeholder
- Never commit files with hardcoded local paths
- Install script generates actual plist from template

## Environment Variables
Required in `.env`:
- `WEBUI_SECRET_KEY` ‚Äî Generate with `openssl rand -hex 32`
- `CHAT_STREAM_RESPONSE_CHUNK_MAX_BUFFER_SIZE` ‚Äî Increase for fast models (default: 10000)

## Common Commands

### Quickstart
```bash
./start.sh                    # Start all services
./install-launchagent.sh      # Enable auto-start
```

### Service Management
```bash
lms status                    # LM Studio status
lms server start --port 1234  # Start LM Studio
docker compose up -d          # Start containers
docker compose down           # Stop containers
docker compose logs -f        # View logs
```

### LaunchAgent
```bash
launchctl list | grep homelab                              # Check status
launchctl unload ~/Library/LaunchAgents/com.homelab.start.plist  # Disable
```

## Cursor IDE Commands
- `quickstart` ‚Äî Full setup
- `ensure-*` ‚Äî Idempotent service startup
- `health-check` ‚Äî Status of all services
- `generate-secret-key` ‚Äî Create WEBUI_SECRET_KEY

## Debugging
1. Check `logs/start.log` and `logs/start.error.log`
2. Run `./start.sh` manually for real-time output
3. Use `docker compose logs` for container issues
4. Verify LM Studio: `lms status`
