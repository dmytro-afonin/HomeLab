---
description: HomeLab project rules - LM Studio + Open WebUI setup for macOS
globs: ["**/*"]
alwaysApply: true
---

# HomeLab Project Guidelines

## Project Overview
A streamlined setup for running **LM Studio** (with MLX acceleration) and **Open WebUI** on macOS. Designed for Apple Silicon Macs.

**Current Version**: See `VERSION` file

## Project Structure

```
HomeLab/
â”œâ”€â”€ VERSION                         # Semantic version
â”œâ”€â”€ hl                              # CLI entry point
â”œâ”€â”€ start.sh                        # LaunchAgent entry point
â”œâ”€â”€ install.sh                      # User installer
â”œâ”€â”€ install-launchagent.sh          # LaunchAgent installer
â”œâ”€â”€ docker-compose.yml              # Container definitions
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â””â”€â”€ log.sh                  # Logging library (versioned)
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ ensure-caffeinate.sh
â”‚   â”‚   â”œâ”€â”€ ensure-lmstudio.sh
â”‚   â”‚   â”œâ”€â”€ ensure-docker-desktop.sh
â”‚   â”‚   â”œâ”€â”€ ensure-containers.sh
â”‚   â”‚   â”œâ”€â”€ stop-*.sh
â”‚   â”‚   â””â”€â”€ stop-all.sh
â”‚   â”œâ”€â”€ logs/
â”‚   â”‚   â”œâ”€â”€ view.sh
â”‚   â”‚   â”œâ”€â”€ tail.sh
â”‚   â”‚   â”œâ”€â”€ stats.sh
â”‚   â”‚   â””â”€â”€ clear.sh
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ doctor.sh
â”‚       â”œâ”€â”€ health-check.sh
â”‚       â”œâ”€â”€ local-ip.sh
â”‚       â””â”€â”€ version.sh
â”œâ”€â”€ .cursor/
â”‚   â”œâ”€â”€ commands/
â”‚   â”‚   â”œâ”€â”€ services/               # Service commands
â”‚   â”‚   â”œâ”€â”€ docker/                 # Docker commands
â”‚   â”‚   â”œâ”€â”€ setup/                  # Setup commands
â”‚   â”‚   â””â”€â”€ utils/                  # Utility commands
â”‚   â””â”€â”€ rules/
â””â”€â”€ logs/                           # Runtime logs (gitignored)
    â””â”€â”€ homelab.db                  # SQLite log database
```

## Versioning

- **Project version**: `VERSION` file (semantic versioning)
- **Library version**: `HOMELAB_LIB_VERSION` in `scripts/lib/log.sh`
- Logs include version for debugging

## Code Standards

### Shell Scripts
- Shebang: `#!/usr/bin/env bash`
- Source lib: `source "$SCRIPT_DIR/../lib/log.sh"`
- Use logging functions: `log_info`, `log_warn`, `log_error`, `log_start`
- Emoji prefixes: âœ… âš ï¸ âŒ ğŸš€ ğŸ§  ğŸ‹ ğŸ³

### Adding New Scripts
1. Create in appropriate `scripts/` subdirectory
2. Source the logging library
3. Make executable: `chmod +x`
4. Create matching Cursor command in `.cursor/commands/`

### Cursor Commands
- Organized by category in subdirectories
- Reference scripts only, no inline logic
- Short, descriptive names

## Logging

SQLite database at `logs/homelab.db`:
- Auto-created on first log
- Includes timestamp, level, service, message, version
- Query with `hl logs`

```bash
hl logs -n 100              # Last 100
hl logs -s lmstudio         # By service
hl logs -l ERROR            # By level
hl logs --tail              # Live tail
hl logs --stats             # Statistics
hl logs --clear             # Clear logs
```

## Services

| Service | Port | Notes |
|---------|------|-------|
| LM Studio | 1234 | Native macOS, MLX/GGUF |
| Open WebUI | 3000 | Docker container |
| Watchtower | â€” | Updates at 2 AM daily |

## CLI (`hl`)

The `hl` command is the main entry point:

```bash
# Service Management
hl start                    # Start all services
hl start --allow-sleep      # Start without caffeinate
hl stop                     # Stop all services
hl restart                  # Restart all
hl status                   # Health check

# Logs
hl logs                     # View logs
hl logs --tail              # Follow live
hl logs -s lmstudio         # Filter by service
hl logs -l ERROR            # Filter by level
hl logs --stats             # Log statistics
hl logs --clear             # Clear logs

# Auto-start
hl auto-start               # Enable auto-start on login
hl auto-start --off         # Disable auto-start

# WebUI Configuration
hl webui buffer-size 50     # Set buffer size (MB)
hl webui list-env           # Show current config

# Utilities
hl ip                       # Show local IP
hl open                     # Open WebUI in browser
hl doctor -v                # System diagnostics

# Maintenance
hl upgrade                  # Upgrade to latest version
hl uninstall                # Remove HomeLab completely
hl version                  # Show version
hl help                     # Show all commands
```
